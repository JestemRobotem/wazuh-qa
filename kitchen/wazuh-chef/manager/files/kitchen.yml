---
driver:
  name: docker
  privileged: true
  use_sudo: false
  use_internal_docker_network: true

provisioner:
  name: chef_zero
  chef_license: accept-no-persist

platforms:
  - name: ubuntu-kitchen-chef
    driver_config:
      image: ubuntu:14.04
      platform: ubuntu
      provision_command: apt-get install -y --force-yes apt-transport-https ca-certificates && apt-get update
      forward: 443
      publish_all: true
  - name: centos-kitchen-chef
    driver_config:
      image: centos:7
      platform: centos
      run_command: /usr/sbin/init
      build_options:
        rm: true
      forward: 443
      publish_all: true
suites:
  - name: manager
    environments_path: ../wazuh_manager/test/environments
    data_bags_path: ../wazuh_manager/test/data_bags
    encrypted_data_bag_secret_key_path: ../wazuh_manager/test/data_bags/wazuh_secrets/test_data_bag_key
    driver:
    run_list:
      - recipe[test::test]
      - recipe[wazuh_manager::repository]
      - recipe[wazuh_manager::manager]
      - recipe[wazuh_filebeat::default]
    attributes:
    provisioner:
      client_rb:
        environment: development-master
    verifier:
      name: shell
      command: py.test -v test/base

  - name: agent
    environments_path: ../wazuh_agent/test/environments
    data_bags_path: ../wazuh_agent/test/data_bags
    encrypted_data_bag_secret_key_path: ../wazuh_agent/test/data_bags/wazuh_secrets/test_data_bag_key
    driver:
    run_list:
      - recipe[test::test]
      - recipe[wazuh_agent::repository]
      - recipe[wazuh_agent::agent]
    attributes:
         vagrant:
    provisioner:
      client_rb:
        environment: development
    verifier:
      name: shell
      command: py.test -v test/base

  - name: elastic
    environments_path: "../wazuh_elastic/test/environments"
    data_bags_path: "../wazuh_elastic/test/data_bags"
    encrypted_data_bag_secret_key_path: "test/data_bags/wazuh_secrets/test_data_bag_key"
    driver:
      customize:
        memory: 4096
        cpus: 2
    run_list:
      - recipe[test::test]
      - recipe[wazuh_elastic::repository]
      - recipe[wazuh_elastic::elasticsearch]
      - recipe[wazuh_elastic::nginx]
      - recipe[wazuh_elastic::kibana] 
    attributes: { wazuh-elastic: {elasticsearch_ip: '127.0.0.1'} } 
    provisioner:
      client_rb:
        environment: development
    verifier:
      name: shell
      command: py.test -v test/base/test_wazuh_elastic.py