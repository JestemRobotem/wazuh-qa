- name: Configure Linux agent environment
  hosts: agent:&linux
  tasks:

    - name: Create directory to monitor
      become: true
      file:
        path: /tmp/test_demo_fim
        state: directory

    - name: Add directory to syscheck configuration
      become: true
      blockinfile:
        path: /var/ossec/etc/ossec.conf
        insertafter: </directories>
        block: |
          <directories check_all="yes" whodata="yes">/tmp/test_demo_fim</directories>
        marker: <!-- {mark} ANSIBLE MANAGED BLOCK -->

    - name: Restart Wazuh
      become: true
      systemd:
        name: wazuh-agent
        state: restarted
