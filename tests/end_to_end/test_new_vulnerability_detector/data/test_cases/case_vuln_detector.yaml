- name: error_while_pulling_new_content
  description: |
    Given a manager
    And an agent connected to that manager
    And the scheduled update is enabled
    And a feed update available
    And a problem in the content-pulling
    When the update process is triggered
    Then the update process fails
    But the user is notified
  configuration_parameters: null
  metadata: null

- name: agents_connected_for_first_time
  description: |
    Given a manager
    And several agents who hasn't connected yet
    And a feed update available
    And the feed has a vulnerability that affects those agents
    And the scheduled update is enabled
    When the feed is updated
    Then the scan is not triggered
    When the agent is connected for the first time
    Then a scan is triggered
    And the result is published
    And the vulnerability appears in the result
  configuration_parameters: null
  metadata: null

- name: scan_when_upgrading
  description: |
    Given a manager
    And a Linux-based agent connected to the manager
    And that agent has a vulnerable package
    When the user upgrade the package to a fixed version
    Then a scan is triggered
    And the result is published
    And the package appears as "solved" in the result
  configuration_parameters: null
  metadata: null

- name: scan_when_removing
  description: |
    Given a manager
    And a Linux-based agent connected to the manager
    And that agent has a vulnerable package
    When the user remove that package
    Then a scan is triggered
    And the result is published
    And the package does not appear in the result
  configuration_parameters: null
  metadata: null

- name: agent_db_doesnt_exist
  description: |
    Given a manager
    And an agent that is not connected to the manager
    And the agent has syscollector disabled
    And the agent database does not exist in the manager
    When the agent is connected for the first time to the manager
    Then the scan is not triggered
  configuration_parameters: null
  metadata: null

- name: scan_when_agent_info_is_old
  description: |
    Given a manager
    And an agent that is not connected to the manager
    And the agent's last scan is old
    When the agent is connected for the first time to the manager
    Then a scan is triggered
    And the result is published
  configuration_parameters: null
  metadata: null

- name: full_scan_manager
  description: |
    Given a manager that has not started yet
    When the user starts the manager for the first time
    Then a full scan is triggered
    And the result is published
  configuration_parameters: null
  metadata: null

- name: full_scan_failed
  description: |
    Given a manager that has not started yet
    And the vulnerability detector configuration is invalid
    When the user starts the manager
    Then the scan is not triggered
    But the user is notified
  configuration_parameters: null
  metadata: null

- name: third_party_get_result
  description: |
    Given a manager
    And an agent connected to that manager
    And a third-party subscribed to the scan results
    When a new vulnerable package is installed in the agent
    Then a scan is triggered
    And the scan result is available to all subscribers
    And the third-party can get the results of the scan
  configuration_parameters: null
  metadata: null

- name: custom_feed_added
  description: |
    Given a manager
    And an agent
    When the user adds custom feed content that affects the agent
    Then a scan is triggered
    And the result is published
  configuration_parameters: null
  metadata: null

- name: custom_feed_matches_wazuh_feed
  description: |
    Given a manager
    When the user adds custom feed content that has already been scanned
    Then the scan is not triggered
  configuration_parameters: null
  metadata: null

- name: package_not_scanned_both_feeds
  description: |
    Given a manager
    And an agent
    And Wazuh's feed has an update of the package "package" with version "2.0"
    And the user's feed has an update of the same package
    And the agent has the "package" installed
    Then the agent is scanned
    And the result is published
    And the result content combines both updates
    And the result is not duplicated
  configuration_parameters: null
  metadata: null
