---

  # Audit

  - name: Pinging as wazuh user to generate audit alerts
    shell: ping -c 5 www.google.com
    become: true
    become_user: wazuh
    when:
      - inventory_hostname in groups['rhel']

  - name: Create file under /home/ssh_user folder
    copy:
      dest: "/home/{{ ansible_ssh_user}}/test_syscheck_file"
      content: |
        This is a test file auto-generated by Ansible.
    when:
      - inventory_hostname in groups['rhel']

  - name: Delete created test file
    file:
      path: "/home/{{ ansible_ssh_user}}/test_syscheck_file"
      state: absent
    when:
      - inventory_hostname in groups['rhel']

  # FIM

  - name: Verify FIM folder exists | Linux
    file:
      path: "{{ linux_virustotal_folder_path }}"
      state: directory
      mode: '755'
    when:
      - inventory_hostname in groups['rhel']

  - name: Generate test file for FIM | Linux
    copy:
      content: "Testing file to generate FIM alerts"
      dest: "{{ fim_linux_folder_path }}{{ fim_test_file_name }}.txt"
      force: yes
      group: root
      owner: root
      mode: '644'
    become: true
    become_user: root
    when:
      - (inventory_hostname in groups['rhel'] or inventory_hostname in groups['masters'])

  - name: Verify FIM folder exists | Windows
    win_file:
      path: "{{ fim_windows_folder_path }}"
      state: directory
    when:
      - inventory_hostname in groups['windows']

  - name: Generate test file for FIM | Windows
    win_file:
      path: "{{ fim_windows_folder_path }}{{ fim_test_file_name }}"
      state: touch
    when:
      - inventory_hostname in groups['windows']

  - name: Adding content to test file for FIM | Windows
    win_lineinfile:
      path: "{{ fim_windows_folder_path }}{{ fim_test_file_name }}"
      line: "This is just a test file for FIM"
    when:
      - inventory_hostname in groups['windows']
