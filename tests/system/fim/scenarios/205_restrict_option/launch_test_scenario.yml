---
  - hosts: all
    vars_files:
      - ../../vars/main.yml

    handlers:
      - import_tasks: ../../handlers/main.yml

    tasks:
      - name: Launching prepare tasks
        import_tasks: "../../common_tasks/prepare.yml"

      - name: Configure syscheck event
        set_fact:
          event: "added"
          elastic_verification_extra_arguments: "-n -r 10"
          json_verification_extra_arguments: "-r 10"

      - name: Add common prefix | File creation
        set_fact:
          create_script_extra_params: "-p fimtest"

      - name: Generating files to trigger FIM alerts
        import_tasks: "../../common_tasks/create_files.yml"

      - name: Verify generated alerts
        become: true
        import_tasks: "../../common_tasks/verify_alerts.yml"

      - name: Configure syscheck event
        set_fact:
          event: "modified"
          elastic_verification_extra_arguments: "-n -r 10"
          json_verification_extra_arguments: "-r 10"

      - name: Modifiying files to trigger FIM alerts
        import_tasks: "../../common_tasks/modify_files.yml"

      - name: Verify generated alerts
        become: true
        import_tasks: "../../common_tasks/verify_alerts.yml"

      - name: Configure syscheck event
        set_fact:
          event: "deleted"
          elastic_verification_extra_arguments: "-n -r 10"
          json_verification_extra_arguments: "-r 10"

      - name: Deleting files to trigger FIM alerts
        import_tasks: "../../common_tasks/delete_files.yml"

      - name: Verify generated alerts
        become: true
        import_tasks: "../../common_tasks/verify_alerts.yml"
