---
  - hosts: all
    vars_files:
      - ../../vars/main.yml

    handlers:
      - import_tasks: ./handlers/main.yml

    tasks:    
      - block:
        - name: Launching prepare tasks 
          import_tasks: "../../common_tasks/prepare.yml"

        - block:
          - name: Configure syscheck event.
            set_fact:
              event: "added"
            notify: Stop Wazuh agent Linux

          - name: Generating files to trigger FIM alerts
            notify: 
              - Restart Wazuh agent Linux
              - Restart Wazuh agent Windows 
            import_tasks: "../../common_tasks/create_files.yml"
            changed_when: true
                    
          - name: Verify generated alerts
            import_tasks: "../../common_tasks/verify_alerts.yml"
          become: yes

        - block:
          - name: Configure syscheck event.
            set_fact:
              event: "modified"
              
          - name: Modifiying files to trigger FIM alerts
            import_tasks: "../../common_tasks/modify_files.yml"
        
          - name: Verify generated alerts
            import_tasks: "../../common_tasks/verify_alerts.yml"
          become: yes

        - block:
          - name: Configure syscheck event.
            set_fact:
              event: "deleted"
              
          - name: Deleting files to trigger FIM alerts
            import_tasks: "../../common_tasks/delete_files.yml"
        
          - name: Verify generated alerts
            import_tasks: "../../common_tasks/verify_alerts.yml"
          become: yes   