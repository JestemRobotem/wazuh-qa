---
  - name: Unlock python-apt package on Debian's families instances
    shell: "apt-mark unhold python-apt apt-transport-https"
    when:
      - inventory_hostname in groups['linuxagents']
      - ansible_os_family == "Debian"

  - name: Install python3-apt package on Debian based OS.
    command: apt install -y python3-apt
    when:
      - inventory_hostname in groups['linuxagents']
      - ansible_os_family == "Debian"

  - name: Configuring Windows Agents
    block:
      - name: Download hotfix for Windows2012
        win_get_url:
          url: https://download.microsoft.com/download/B/2/4/B24FB08A-DEA8-4B4C-8EE4-B9F0FB180200/Windows8.1-KB3035131-x64.msu
          dest: c:\temp\KB3035131.msu
        when:
          - "'Windows2012' in {{ hostvars[inventory_hostname]['wazuh_agent_authd']['agent_name'] }}"

      - name: Installing required hotfix on Windows2012
        win_hotfix:
          hotfix_kb: KB3035131
          source: c:\temp\KB3035131
          state: present
        when:
          - "'Windows2012' in {{ hostvars[inventory_hostname]['agent_name'] }}"

      - name: Installing Google Chrome
        win_chocolatey:
          name: googlechrome
          version: 79.0.3945.130
          pinned: yes
          state: present
          ignore_checksums: yes

      - name: Installing Python on Windows hosts
        win_chocolatey:
          name: python
          version: 3.8.2
          pinned: yes
          state: present
          ignore_checksums: yes
    when:
      - ansible_os_family == "Windows"
