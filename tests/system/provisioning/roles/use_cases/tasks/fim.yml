---
  - name: Enabling realtime in /etc,/usr/bin,/usr/sbin
    replace:
      path: "{{ wazuh_installation_path }}etc/ossec.conf"
      regexp: '<directories check_all="yes">/etc,/usr/bin,/usr/sbin</directories>'
      replace: '<directories check_all="yes" realtime="yes">/etc,/usr/bin,/usr/sbin</directories>'
    when:
      - ((master is defined) and (master)) or ((agent is defined) and (agent))

  - name: Enable realtime in /bin,/sbin,/boot
    replace:
      path: "{{ wazuh_installation_path }}etc/ossec.conf"
      regexp: '<directories check_all="yes">/bin,/sbin,/boot</directories>'
      replace: '<directories check_all="yes" realtime="yes">/bin,/sbin,/boot</directories>'
    when:
      - ((master is defined) and (master)) or ((agent is defined) and (agent))

  - name: Configure Syscheck for RHEL Agent
    blockinfile:
      marker: "<!-- {mark} Syscheck Linux configuration -->"
      path: "{{ wazuh_installation_path }}etc/shared/redhat/agent.conf"
      block: |
        <agent_config>
          <syscheck>
              <disabled>no</disabled>
              <frequency>43200</frequency>
              <scan_on_start>yes</scan_on_start>
              <!-- Files/directories to monitor -->
              <directories check_all="yes" whodata="yes">/usr/bin,/usr/sbin</directories>
              <directories check_all="yes" whodata="yes">/bin,/sbin,/boot</directories>
              <directories check_all="yes" report_changes="yes" whodata="yes" tags="cron">/etc/cron*</directories>
              <directories check_all="yes" report_changes="yes" whodata="yes" recursion_level="2">/home,/root</directories>
              <directories check_all="yes" report_changes="yes" whodata="yes" tags="tmp" restrict="!.tmp$">/tmp</directories>
              <!-- Files/directories to ignore -->
              <ignore>/etc/mtab</ignore>
              <ignore>/etc/hosts.deny</ignore>
              <ignore>/etc/mail/statistics</ignore>
              <ignore>/etc/random-seed</ignore>
              <ignore>/etc/random.seed</ignore>
              <ignore>/etc/adjtime</ignore>
              <ignore>/etc/httpd/logs</ignore>
              <ignore>/etc/utmpx</ignore>
              <ignore>/etc/wtmpx</ignore>
              <ignore>/etc/cups/certs</ignore>
              <ignore>/etc/dumpdates</ignore>
              <ignore>/etc/svc/volatile</ignore>
              <!-- File extensions ignored -->
              <ignore type="sregex">.log$|.tmp$|.swp$|.viminfo$</ignore>
              <!-- Check the file, but never compute the diff -->
              <nodiff>/etc/ssl/private.key</nodiff>
              <!-- NFS files -->
              <skip_nfs>yes</skip_nfs>
            </syscheck>      
        </agent_config>
    when:
      - (master is defined) and (master)

  - name: Configure OSquery in the Wazuh configuration file
    blockinfile:
      marker: "<!-- {mark} Osquery configuration -->"
      path: "{{ wazuh_installation_path }}etc/shared/windows/agent.conf"
      block: |
        <agent_config>
          <syscheck>
            <scan_on_start>yes</scan_on_start>
            <directories check_all="yes" report_changes="yes" whodata="yes">C:\Santiago</directories>
          </syscheck>
        </agent_config>
    when:
      - (master is defined) and (master)
